<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Google Web Speech API Test </title>
</head>

<body>

    <button id="btnState" onclick="btnStateClick();">開始辨識</button>
    <button id="btnClearLast" onclick="clearLast()">清除最後一項</button>
    <button id="btnClearAll" onclick="clearAll()">全部清除</button>
    <h4>辨識的文字會顯示在下方選單：</h4>
    <span id="spSelect"></span>

    <script type="text/javascript">
        var recognizing;
        var recognition = new webkitSpeechRecognition();
        recognition.continuous = true;
        recognition.interimResults = true;
        recognition.lang = "cmn-Hant-TW";
        recognition.onstart = function() {
            console.log('開始辨識...');
        }
        recognition.onend = function() {
            console.log('停止辨識!');
        };
        recognition.maxAlternatives = 10;
        recognition.onresult = function(event) {
            var len = event.results.length;
            if (len > 0) {
                for (var i = 0; i < len; i++) {
                    if (i == 0)
                        document.getElementById("spSelect").innerHTML += "<select id='select" + i + "'>" + "</select>";
                    else
                        document.getElementById("spSelect").innerHTML += " + " + "<select id='select" + i + "'>" + "</select>";
                    for (var j = 0; j < event.results[i].length; j++) {
                        var text = event.results[i][j].transcript;
                        document.getElementById('select' + i).options[j] = new Option(text, text);
                    }
                }
            }
        }

        function stop() {
            recognition.stop();
            recognizing = false;
        }

        function start() {
            recognition.start();
            recognizing = true;
        }

        function btnStateClick() {
            var elem = document.getElementById('btnState');
            var txt = elem.textContent || elem.innerText;
            if (txt == "開始辨識") {
                start();
                elem.innerHTML = "停止辨識";
            } else {
                stop();
                elem.innerHTML = "開始辨識";
            }
        }

        function clearLast() {

        }

        function clearAll() {

        }

    </script>
</body>

</html>
